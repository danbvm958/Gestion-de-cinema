<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>S√©ances - Cin√©ma CY Tech</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar">
        <a href="{{ url_for('accueil') }}" class="navbar-brand">Cin√©ma CY Tech</a>
        <ul class="nav-links">
            <li><a href="{{ url_for('accueil') }}">Accueil</a></li>
            <li><a href="/seances_page">S√©ances</a></li>
            {% if session.role == 'admin' %}
                <li><a href="{{ url_for('ajout_film') }}">Ajouter un film</a></li>
                <li><a href="/ajoutseance">Ajouter une s√©ance</a></li>
            {% endif %}
        </ul>
    </nav>

    <div class="container">
        <div class="card" style="max-width: 900px; margin: 2rem auto;">
            <div class="card-header">
                <h1>üéûÔ∏è S√©ances Programm√©es</h1>
                <p>Consultez toutes les s√©ances disponibles</p>
            </div>

            <div id="seancesList">
                <div class="spinner" id="loadingSpinner"></div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="footer">
        <p>&copy; 2025 Cin√©ma CY Tech</p>
    </footer>

    <script>
        const seancesList = document.getElementById('seancesList');
        const loadingSpinner = document.getElementById('loadingSpinner');

        // Charger les s√©ances au chargement de la page
        loadSeances();

        async function loadSeances() {
            try {
                loadingSpinner.style.display = 'block';
                const response = await fetch('/seances');
                const seances = await response.json();
                
                loadingSpinner.style.display = 'none';

                if (seances.length === 0) {
                    seancesList.innerHTML = '<p class="text-light text-center" style="padding: 2rem;">Aucune s√©ance programm√©e pour le moment</p>';
                    return;
                }

                let html = '<div style="display: flex; flex-direction: column; gap: 1rem;">';
                
                // Grouper par date
                const seancesByDate = {};
                seances.forEach(s => {
                    const date = s.horaire.split(' ')[0];
                    if (!seancesByDate[date]) {
                        seancesByDate[date] = [];
                    }
                    seancesByDate[date].push(s);
                });

                // Afficher par date
                Object.keys(seancesByDate).sort().forEach(date => {
                    html += `<h3 style="color: var(--primary-color); margin-top: 1rem;">üìÖ ${formatDate(date)}</h3>`;
                    
                    seancesByDate[date].forEach(seance => {
                        const time = seance.horaire.split(' ')[1];
                        html += `
                            <div style="padding: 1.25rem; background: linear-gradient(135deg, #f9fafb 0%, #ffffff 100%); border-radius: 12px; border-left: 5px solid var(--primary-color); box-shadow: var(--shadow-sm);">
                                <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 1rem;">
                                    <div style="flex: 1; min-width: 200px;">
                                        <h4 style="color: var(--text-dark); font-size: 1.2rem; margin-bottom: 0.5rem;">${seance.film}</h4>
                                        <div style="display: flex; gap: 1.5rem; flex-wrap: wrap; color: var(--text-light); font-size: 0.95rem;">
                                            <div><strong>üïê Horaire:</strong> ${time}</div>
                                            <div><strong>üö™ Salle:</strong> ${seance.salle}</div>
                                        </div>
                                    </div>
                                    <div style="text-align: right;">
                                        <span style="background: var(--primary-color); color: white; padding: 0.5rem 1rem; border-radius: 8px; font-weight: 600; font-size: 0.9rem;">
                                            Salle ${seance.salle}
                                        </span>
                                    </div>
                                </div>
                            </div>
                        `;
                    });
                });
                
                html += '</div>';
                seancesList.innerHTML = html;
            } catch (error) {
                loadingSpinner.style.display = 'none';
                console.error('Erreur lors du chargement des s√©ances:', error);
                seancesList.innerHTML = '<div class="alert alert-error">Erreur lors du chargement des s√©ances</div>';
            }
        }

        function formatDate(dateStr) {
            const date = new Date(dateStr);
            const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
            return date.toLocaleDateString('fr-FR', options);
        }
    </script>
</body>
</html>
